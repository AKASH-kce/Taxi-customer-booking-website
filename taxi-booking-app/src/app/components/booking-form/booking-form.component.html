<div class="booking-form">
  <h3 class="text-center mb-4">Book Your Ride</h3>
  
  <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()">
    <div class="row">
      <!-- Pickup Location -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Pickup Location *</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
          <input 
            type="text" 
            class="form-control" 
            formControlName="pickupLocation"
            placeholder="Enter pickup location"
            [class.is-invalid]="bookingForm.get('pickupLocation')?.invalid && bookingForm.get('pickupLocation')?.touched"
          >
          <button 
            type="button" 
            class="btn btn-outline-primary" 
            (click)="getCurrentLocation()"
            title="Use Current Location"
          >
            <i class="fas fa-crosshairs"></i>
          </button>
          <button 
            type="button" 
            class="btn btn-outline-primary" 
            (click)="togglePickupMap()"
            title="Pick on Map"
          >
            <i class="fas fa-map"></i>
          </button>
        </div>
        <div class="invalid-feedback" *ngIf="getFieldError('pickupLocation')">
          {{ getFieldError('pickupLocation') }}
        </div>
        
        <!-- Location Predictions -->
        <div class="predictions-dropdown" *ngIf="pickupPredictions.length > 0">
          <div 
            class="prediction-item" 
            *ngFor="let prediction of pickupPredictions"
            (click)="selectPlacePrediction(prediction, 'pickup')"
          >
            <i class="fas fa-map-marker-alt text-primary me-2"></i>
            <div>
              <div class="prediction-main">{{ prediction.structured_formatting?.main_text || prediction.description }}</div>
              <div class="prediction-secondary">{{ prediction.structured_formatting?.secondary_text || '' }}</div>
            </div>
          </div>
        </div>
        <div class="map-container mt-2" *ngIf="showPickupMap">
          <div id="pickupMapContainer" style="height: 300px; border-radius: 10px;"></div>
        </div>
      </div>

      <!-- Drop Location -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Drop Location *</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
          <input 
            type="text" 
            class="form-control" 
            formControlName="dropLocation"
            placeholder="Enter drop location"
            [class.is-invalid]="bookingForm.get('dropLocation')?.invalid && bookingForm.get('dropLocation')?.touched"
          >
          <button 
            type="button" 
            class="btn btn-outline-primary" 
            (click)="toggleDropMap()"
            title="Pick on Map"
          >
            <i class="fas fa-map"></i>
          </button>
        </div>
        <div class="invalid-feedback" *ngIf="getFieldError('dropLocation')">
          {{ getFieldError('dropLocation') }}
        </div>
        
        <!-- Location Predictions -->
        <div class="predictions-dropdown" *ngIf="dropPredictions.length > 0">
          <div 
            class="prediction-item" 
            *ngFor="let prediction of dropPredictions"
            (click)="selectPlacePrediction(prediction, 'drop')"
          >
            <i class="fas fa-map-marker-alt text-primary me-2"></i>
            <div>
              <div class="prediction-main">{{ prediction.structured_formatting?.main_text || prediction.description }}</div>
              <div class="prediction-secondary">{{ prediction.structured_formatting?.secondary_text || '' }}</div>
            </div>
          </div>
        </div>
        <div class="map-container mt-2" *ngIf="showDropMap">
          <div id="dropMapContainer" style="height: 300px; border-radius: 10px;"></div>
        </div>
      </div>

      <!-- Trip Type -->
      <div class="col-md-4 mb-3">
        <label class="form-label">Trip Type *</label>
        <select class="form-select" formControlName="tripType" [class.is-invalid]="bookingForm.get('tripType')?.invalid && bookingForm.get('tripType')?.touched">
          <option value="">Select Trip Type</option>
          <option value="local">Local</option>
          <option value="outstation">Out Station</option>
          <option value="hourly">Hourly</option>
        </select>
        <div class="invalid-feedback" *ngIf="getFieldError('tripType')">
          {{ getFieldError('tripType') }}
        </div>
      </div>

      <!-- Trip Mode -->
      <div class="col-md-4 mb-3">
        <label class="form-label">Trip Mode *</label>
        <select class="form-select" formControlName="tripMode" [class.is-invalid]="bookingForm.get('tripMode')?.invalid && bookingForm.get('tripMode')?.touched">
          <option value="">Select Trip Mode</option>
          <option value="oneway">One Way</option>
          <option value="roundtrip">Round Trip</option>
        </select>
        <div class="invalid-feedback" *ngIf="getFieldError('tripMode')">
          {{ getFieldError('tripMode') }}
        </div>
      </div>

      <!-- Vehicle Type -->
      <div class="col-md-4 mb-3">
        <label class="form-label">Vehicle Type *</label>
        <select class="form-select" formControlName="vehicleType" [class.is-invalid]="bookingForm.get('vehicleType')?.invalid && bookingForm.get('vehicleType')?.touched">
          <option value="">Select Vehicle</option>
          <option *ngFor="let vehicle of vehicleTypes" [value]="vehicle.id">
            {{ vehicle.name }} - â‚¹{{ vehicle.baseFare }}/km
          </option>
        </select>
        <div class="invalid-feedback" *ngIf="getFieldError('vehicleType')">
          {{ getFieldError('vehicleType') }}
        </div>
      </div>

      <!-- Pickup Date -->
      <div class="col-md-4 mb-3">
        <label class="form-label">Pickup Date *</label>
        <input 
          type="date" 
          class="form-control" 
          formControlName="pickupDate"
          [class.is-invalid]="bookingForm.get('pickupDate')?.invalid && bookingForm.get('pickupDate')?.touched"
        >
        <div class="invalid-feedback" *ngIf="getFieldError('pickupDate')">
          {{ getFieldError('pickupDate') }}
        </div>
      </div>

      <!-- Pickup Time -->
      <div class="col-md-4 mb-3">
        <label class="form-label">Pickup Time *</label>
        <input 
          type="time" 
          class="form-control" 
          formControlName="pickupTime"
          [class.is-invalid]="bookingForm.get('pickupTime')?.invalid && bookingForm.get('pickupTime')?.touched"
        >
        <div class="invalid-feedback" *ngIf="getFieldError('pickupTime')">
          {{ getFieldError('pickupTime') }}
        </div>
      </div>
        <!-- Pickup distance -->
      <div class="col-md-4 mb-3">
        <label class="form-label">Distance(km) *</label>
        <input 
          type="number" 
          class="form-control" 
          formControlName="pickupDistance"
          placeholder="Enter Distance"
          step="0.1"
          min="0.1"
          [class.is-invalid]="bookingForm.get('pickupDistance')?.invalid && bookingForm.get('pickupDistance')?.touched"
        >
        <div class="invalid-feedback" *ngIf="getFieldError('pickupDistance')">
          {{ getFieldError('pickupDistance') }}
        </div>
      </div>

      <!-- Passenger Name -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Passenger Name *</label>
        <input 
          type="text" 
          class="form-control" 
          formControlName="passengerName"
          placeholder="Enter passenger name"
          [class.is-invalid]="bookingForm.get('passengerName')?.invalid && bookingForm.get('passengerName')?.touched"
        >
        <div class="invalid-feedback" *ngIf="getFieldError('passengerName')">
          {{ getFieldError('passengerName') }}
        </div>
      </div>

      <!-- Passenger Phone -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Passenger Phone *</label>
        <input 
          type="tel" 
          class="form-control" 
          formControlName="passengerPhone"
          placeholder="Enter 10-digit phone number"
          [class.is-invalid]="bookingForm.get('passengerPhone')?.invalid && bookingForm.get('passengerPhone')?.touched"
        >
        <div class="invalid-feedback" *ngIf="getFieldError('passengerPhone')">
          {{ getFieldError('passengerPhone') }}
        </div>
      </div>

      <!-- Passenger Email -->
      <div class="col-12 mb-3">
        <label class="form-label">Passenger Email *</label>
        <input 
          type="email" 
          class="form-control" 
          formControlName="passengerEmail"
          placeholder="Enter email address"
          [class.is-invalid]="bookingForm.get('passengerEmail')?.invalid && bookingForm.get('passengerEmail')?.touched"
        >
        <div class="invalid-feedback" *ngIf="getFieldError('passengerEmail')">
          {{ getFieldError('passengerEmail') }}
        </div>
      </div>

      <!-- Special Instructions -->
      <div class="col-12 mb-3">
        <label class="form-label">Special Instructions</label>
        <textarea 
          class="form-control" 
          rows="3" 
          formControlName="specialInstructions"
          placeholder="Any special instructions or requirements"
        ></textarea>
      </div>

      <!-- Fare Estimate -->
      <div class="col-12 mb-3" *ngIf="showFareEstimate || isCalculatingFare">
        <div class="fare-estimate-card">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-calculator text-primary me-2"></i>
              Estimated Fare
            </h5>
            <div *ngIf="isCalculatingFare" class="text-primary">
              <i class="fas fa-spinner fa-spin me-2"></i>
              Calculating...
            </div>
          </div>
          <div *ngIf="showFareEstimate" class="fare-amount">
            <span class="currency">â‚¹</span>
            <span class="amount">{{ estimatedFare }}</span>
            <span class="unit">approx.</span>
          </div>
          <small class="text-muted">
            *Final fare may vary based on actual route and traffic conditions
          </small>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="col-12 text-center">
        <button 
          type="submit" 
          class="btn btn-primary btn-lg"
          [disabled]="bookingForm.invalid || isLoading"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
          {{ isLoading ? 'Booking...' : 'Book Now' }}
        </button>
      </div>
    </div>
  </form>

  <!-- Loading Spinner -->
  <app-loading-spinner 
    *ngIf="isLoading" 
    [message]="'Processing your booking...'"
    [showOverlay]="true">
  </app-loading-spinner>
</div>
